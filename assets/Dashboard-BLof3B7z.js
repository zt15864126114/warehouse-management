import{i as _}from"./echarts-BciqUSOs.js";import{s as r,a as N}from"./index-B1hpe8I_.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as c,o as P,n as A,U as R,w as W,f as V,k as h,g as s,y as o,x as e,j as n,V as X,R as G,S as J,e as v,W as Q,Q as D,J as y,I as i,T as $,X as q,u as T}from"./element-plus-D9U92kps.js";const K={class:"dashboard"},Y={class:"card-content"},Z={class:"card-info"},tt={class:"card-title"},at={class:"card-value"},et={class:"card-trend"},st={class:"chart-container"},rt={class:"chart-header"},ot={class:"chart-header"},lt={class:"chart-header"},nt={class:"chart-header"},dt={name:"Dashboard"},it=Object.assign(dt,{setup(ct){const L=c(r.state.dashboard.cards),g=c(null),C=c(null),w=c(null),z=c(null),E=c(null);let d=[];const O=()=>{d.forEach(t=>{t.resizeHandler&&window.removeEventListener("resize",t.resizeHandler),t.dispose()}),d=[];const a={trendChart:null,typeChart:null,locationChart:null,alarmChart:null,alarmTypeChart:null};if(g.value){a.trendChart=_(g.value);const t=()=>a.trendChart.resize();window.addEventListener("resize",t),a.trendChart.resizeHandler=t,d.push(a.trendChart)}if(C.value){a.typeChart=_(C.value);const t=()=>a.typeChart.resize();window.addEventListener("resize",t),a.typeChart.resizeHandler=t,d.push(a.typeChart)}if(w.value){a.locationChart=_(w.value);const t=()=>a.locationChart.resize();window.addEventListener("resize",t),a.locationChart.resizeHandler=t,d.push(a.locationChart)}if(z.value){a.alarmChart=_(z.value);const t=()=>a.alarmChart.resize();window.addEventListener("resize",t),a.alarmChart.resizeHandler=t,d.push(a.alarmChart)}if(E.value){a.alarmTypeChart=_(E.value);const t=()=>a.alarmTypeChart.resize();window.addEventListener("resize",t),a.alarmTypeChart.resizeHandler=t,d.push(a.alarmTypeChart)}return a},B=async()=>{try{const{data:a}=await N.get("/api/dashboard/overview");if(a.code===200){const t=a.data;r.setDashboardData({cards:[{title:"总库存量",value:t.totalInventory.toLocaleString(),trend:5.2,icon:"Box",color:"#409EFF"},{title:"今日入库",value:t.todayInbound.toLocaleString(),trend:12.5,icon:"Goods",color:"#67C23A"},{title:"今日出库",value:t.todayOutbound.toLocaleString(),trend:-3.8,icon:"Van",color:"#E6A23C"},{title:"库存金额",value:`￥${t.totalAmount.toLocaleString()}`,trend:8.3,icon:"Money",color:"#F56C6C"}],trends:t.inventoryTrend,distribution:t.categoryDistribution,usage:t.locationUsage,alarms:t.recentAlarms,alarmStats:t.alarmStats}),L.value=r.state.dashboard.cards,A(()=>{x()})}}catch(a){console.error("获取仪表盘数据失败:",a),X.error("获取仪表盘数据失败")}},x=()=>{const a=O();a.trendChart&&r.state.dashboard.trends&&a.trendChart.setOption({tooltip:{trigger:"axis"},legend:{data:["入库量","出库量"]},xAxis:{type:"category",data:["周一","周二","周三","周四","周五","周六","周日"]},yAxis:{type:"value"},series:[{name:"入库量",type:"line",smooth:!0,data:r.state.dashboard.trends.inbound},{name:"出库量",type:"line",smooth:!0,data:r.state.dashboard.trends.outbound}]}),a.typeChart&&r.state.dashboard.distribution&&a.typeChart.setOption({tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",left:"left"},series:[{name:"库存分类",type:"pie",radius:"50%",data:r.state.dashboard.distribution,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}),a.locationChart&&r.state.dashboard.usage&&a.locationChart.setOption({tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},xAxis:{type:"category",data:r.state.dashboard.usage.map(t=>t.name)},yAxis:{type:"value",max:100,axisLabel:{formatter:"{value}%"}},series:[{type:"bar",data:r.state.dashboard.usage.map(t=>t.value),itemStyle:{color:function(t){const m=t.value;return m>80?"#F56C6C":m>60?"#E6A23C":"#67C23A"}},label:{show:!0,position:"top",formatter:"{c}%"}}]}),a.alarmChart&&r.state.dashboard.alarmStats&&a.alarmChart.setOption({tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:["严重告警","一般告警"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:r.state.dashboard.alarmStats.trend.map(t=>t.date)},yAxis:{type:"value"},series:[{name:"严重告警",type:"bar",stack:"total",data:r.state.dashboard.alarmStats.trend.map(t=>t.severe),itemStyle:{color:"#F56C6C"}},{name:"一般告警",type:"bar",stack:"total",data:r.state.dashboard.alarmStats.trend.map(t=>t.warning),itemStyle:{color:"#E6A23C"}}]}),a.alarmTypeChart&&r.state.dashboard.alarmStats&&a.alarmTypeChart.setOption({tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",left:"left",data:r.state.dashboard.alarmStats.types.map(t=>t.name)},series:[{name:"告警类型",type:"pie",radius:["50%","70%"],avoidLabelOverlap:!1,label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"14",fontWeight:"bold"}},labelLine:{show:!1},data:r.state.dashboard.alarmStats.types.map(t=>({value:t.value,name:t.name}))}]})};P(()=>{r.state.dashboard.cards.length?A(()=>{x()}):B()}),R(()=>{d.forEach(a=>{a.resizeHandler&&window.removeEventListener("resize",a.resizeHandler),a.dispose()}),d=[]});const U=()=>r.state.dashboard.usage?Math.max(...r.state.dashboard.usage.map(a=>a.value)):0,S=c("week");return W(S,a=>{x()}),(a,t)=>{const m=n("el-icon"),u=n("el-card"),p=n("el-col"),b=n("el-row"),H=n("el-radio-button"),F=n("el-radio-group"),k=n("el-tag"),I=n("el-button"),f=n("el-table-column"),M=n("el-table");return h(),V("div",K,[s(b,{gutter:20},{default:e(()=>[(h(!0),V(G,null,J(L.value,l=>(h(),v(p,{span:6,key:l.title},{default:e(()=>[s(u,{class:"data-card","body-style":{padding:"20px"}},{default:e(()=>[o("div",Y,[o("div",{class:"card-icon",style:Q({backgroundColor:l.color+"15"})},[s(m,{size:24,color:l.color},{default:e(()=>[(h(),v(D(l.icon)))]),_:2},1032,["color"])],4),o("div",Z,[o("div",tt,y(l.title),1),o("div",at,y(l.value),1),o("div",et,[t[1]||(t[1]=i(" 较昨日 ")),o("span",{class:$(l.trend>=0?"up":"down")},[i(y(Math.abs(l.trend))+"% ",1),s(m,null,{default:e(()=>[(h(),v(D(l.trend>=0?"CaretTop":"CaretBottom")))]),_:2},1024)],2)])])])]),_:2},1024)]),_:2},1024))),128))]),_:1}),o("div",st,[s(b,{gutter:20,class:"charts-row"},{default:e(()=>[s(p,{span:16},{default:e(()=>[s(u,{class:"chart-card"},{header:e(()=>[o("div",rt,[t[4]||(t[4]=o("span",{class:"title"},"出入库趋势",-1)),s(F,{modelValue:S.value,"onUpdate:modelValue":t[0]||(t[0]=l=>S.value=l),size:"small"},{default:e(()=>[s(H,{label:"week"},{default:e(()=>t[2]||(t[2]=[i("本周")])),_:1}),s(H,{label:"month"},{default:e(()=>t[3]||(t[3]=[i("本月")])),_:1})]),_:1},8,["modelValue"])])]),default:e(()=>[o("div",{ref_key:"stockTrendChart",ref:g,style:{height:"350px"}},null,512)]),_:1})]),_:1}),s(p,{span:8},{default:e(()=>[s(u,{class:"chart-card"},{header:e(()=>t[5]||(t[5]=[o("div",{class:"chart-header"},[o("span",{class:"title"},"库存分类占比")],-1)])),default:e(()=>[o("div",{ref_key:"stockTypeChart",ref:C,style:{height:"350px"}},null,512)]),_:1})]),_:1})]),_:1}),s(b,{gutter:20,class:"charts-row"},{default:e(()=>[s(p,{span:12},{default:e(()=>[s(u,{class:"chart-card"},{header:e(()=>[o("div",ot,[t[7]||(t[7]=o("span",{class:"title"},"库位使用率",-1)),U()>=90?(h(),v(k,{key:0,type:"danger",size:"small"},{default:e(()=>t[6]||(t[6]=[i("库位紧张")])),_:1})):q("",!0)])]),default:e(()=>[o("div",{ref_key:"locationUsageChart",ref:w,style:{height:"300px"}},null,512)]),_:1})]),_:1}),s(p,{span:12},{default:e(()=>[s(u,{class:"chart-card"},{header:e(()=>[o("div",lt,[t[8]||(t[8]=o("span",{class:"title"},"告警统计",-1)),s(k,{type:T(r).state.dashboard.alarmStats.severe>0?"danger":"success",size:"small"},{default:e(()=>[i(y(T(r).state.dashboard.alarmStats.severe)+"个严重告警 ",1)]),_:1},8,["type"])])]),default:e(()=>[o("div",{ref_key:"alarmStatChart",ref:z,style:{height:"300px"}},null,512)]),_:1})]),_:1})]),_:1}),s(b,{gutter:20,class:"charts-row"},{default:e(()=>[s(p,{span:24},{default:e(()=>[s(u,{class:"chart-card"},{header:e(()=>[o("div",nt,[t[10]||(t[10]=o("span",{class:"title"},"实时告警",-1)),s(I,{type:"primary",link:""},{default:e(()=>t[9]||(t[9]=[i("查看全部")])),_:1})])]),default:e(()=>[s(M,{data:T(r).state.dashboard.alarms,style:{width:"100%"},size:"large"},{default:e(()=>[s(f,{prop:"time",label:"时间",width:"180"}),s(f,{prop:"title",label:"告警标题",width:"200"}),s(f,{prop:"content",label:"告警内容"}),s(f,{prop:"location",label:"位置",width:"150"}),s(f,{prop:"level",label:"级别",width:"100"},{default:e(({row:l})=>[s(k,{type:l.level==="严重"?"danger":"warning"},{default:e(()=>[i(y(l.level),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1})])])}}}),ft=j(it,[["__scopeId","data-v-e5135c3f"]]);export{ft as default};
