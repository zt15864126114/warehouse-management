import{i as a}from"./echarts-8WmdNKIg.js";import{s as e,a as t}from"./index-B95quUki.js";import{_ as r}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{r as s,o as l,n as d,U as o,w as i,f as n,k as c,g as h,y as u,x as p,j as m,V as y,R as v,S as b,e as f,W as g,Q as C,J as w,I as _,T as x,X as z,u as S}from"./element-plus-D3gz1akn.js";const k={class:"dashboard"},L={class:"card-content"},A={class:"card-info"},E={class:"card-title"},T={class:"card-value"},H={class:"card-trend"},O={class:"chart-container"},j={class:"chart-header"},F={class:"chart-header"},V={class:"chart-header"},D={class:"chart-header"},I={name:"Dashboard"},U=r(Object.assign(I,{setup(r){const I=s(e.state.dashboard.cards),U=s(null),B=s(null),M=s(null),P=s(null),W=s(null);let X=[];const G=()=>{const t=(()=>{X.forEach((a=>{a.resizeHandler&&window.removeEventListener("resize",a.resizeHandler),a.dispose()})),X=[];const e={trendChart:null,typeChart:null,locationChart:null,alarmChart:null,alarmTypeChart:null};if(U.value){e.trendChart=a(U.value);const t=()=>e.trendChart.resize();window.addEventListener("resize",t),e.trendChart.resizeHandler=t,X.push(e.trendChart)}if(B.value){e.typeChart=a(B.value);const t=()=>e.typeChart.resize();window.addEventListener("resize",t),e.typeChart.resizeHandler=t,X.push(e.typeChart)}if(M.value){e.locationChart=a(M.value);const t=()=>e.locationChart.resize();window.addEventListener("resize",t),e.locationChart.resizeHandler=t,X.push(e.locationChart)}if(P.value){e.alarmChart=a(P.value);const t=()=>e.alarmChart.resize();window.addEventListener("resize",t),e.alarmChart.resizeHandler=t,X.push(e.alarmChart)}if(W.value){e.alarmTypeChart=a(W.value);const t=()=>e.alarmTypeChart.resize();window.addEventListener("resize",t),e.alarmTypeChart.resizeHandler=t,X.push(e.alarmTypeChart)}return e})();t.trendChart&&e.state.dashboard.trends&&t.trendChart.setOption({tooltip:{trigger:"axis"},legend:{data:["入库量","出库量"]},xAxis:{type:"category",data:["周一","周二","周三","周四","周五","周六","周日"]},yAxis:{type:"value"},series:[{name:"入库量",type:"line",smooth:!0,data:e.state.dashboard.trends.inbound},{name:"出库量",type:"line",smooth:!0,data:e.state.dashboard.trends.outbound}]}),t.typeChart&&e.state.dashboard.distribution&&t.typeChart.setOption({tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",left:"left"},series:[{name:"库存分类",type:"pie",radius:"50%",data:e.state.dashboard.distribution,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}),t.locationChart&&e.state.dashboard.usage&&t.locationChart.setOption({tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},xAxis:{type:"category",data:e.state.dashboard.usage.map((a=>a.name))},yAxis:{type:"value",max:100,axisLabel:{formatter:"{value}%"}},series:[{type:"bar",data:e.state.dashboard.usage.map((a=>a.value)),itemStyle:{color:function(a){const e=a.value;return e>80?"#F56C6C":e>60?"#E6A23C":"#67C23A"}},label:{show:!0,position:"top",formatter:"{c}%"}}]}),t.alarmChart&&e.state.dashboard.alarmStats&&t.alarmChart.setOption({tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:["严重告警","一般告警"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:e.state.dashboard.alarmStats.trend.map((a=>a.date))},yAxis:{type:"value"},series:[{name:"严重告警",type:"bar",stack:"total",data:e.state.dashboard.alarmStats.trend.map((a=>a.severe)),itemStyle:{color:"#F56C6C"}},{name:"一般告警",type:"bar",stack:"total",data:e.state.dashboard.alarmStats.trend.map((a=>a.warning)),itemStyle:{color:"#E6A23C"}}]}),t.alarmTypeChart&&e.state.dashboard.alarmStats&&t.alarmTypeChart.setOption({tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",left:"left",data:e.state.dashboard.alarmStats.types.map((a=>a.name))},series:[{name:"告警类型",type:"pie",radius:["50%","70%"],avoidLabelOverlap:!1,label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"14",fontWeight:"bold"}},labelLine:{show:!1},data:e.state.dashboard.alarmStats.types.map((a=>({value:a.value,name:a.name})))}]})};l((()=>{e.state.dashboard.cards.length?d((()=>{G()})):(async()=>{try{const{data:a}=await t.get("/api/dashboard/overview");if(200===a.code){const t=a.data;e.setDashboardData({cards:[{title:"总库存量",value:t.totalInventory.toLocaleString(),trend:5.2,icon:"Box",color:"#409EFF"},{title:"今日入库",value:t.todayInbound.toLocaleString(),trend:12.5,icon:"Goods",color:"#67C23A"},{title:"今日出库",value:t.todayOutbound.toLocaleString(),trend:-3.8,icon:"Van",color:"#E6A23C"},{title:"库存金额",value:`￥${t.totalAmount.toLocaleString()}`,trend:8.3,icon:"Money",color:"#F56C6C"}],trends:t.inventoryTrend,distribution:t.categoryDistribution,usage:t.locationUsage,alarms:t.recentAlarms,alarmStats:t.alarmStats}),I.value=e.state.dashboard.cards,d((()=>{G()}))}}catch(a){y.error("获取仪表盘数据失败")}})()})),o((()=>{X.forEach((a=>{a.resizeHandler&&window.removeEventListener("resize",a.resizeHandler),a.dispose()})),X=[]}));const J=s("week");return i(J,(a=>{G()})),(a,t)=>{const r=m("el-icon"),s=m("el-card"),l=m("el-col"),d=m("el-row"),o=m("el-radio-button"),i=m("el-radio-group"),y=m("el-tag"),W=m("el-button"),X=m("el-table-column"),G=m("el-table");return c(),n("div",k,[h(d,{gutter:20},{default:p((()=>[(c(!0),n(v,null,b(I.value,(a=>(c(),f(l,{span:6,key:a.title},{default:p((()=>[h(s,{class:"data-card","body-style":{padding:"20px"}},{default:p((()=>[u("div",L,[u("div",{class:"card-icon",style:g({backgroundColor:a.color+"15"})},[h(r,{size:24,color:a.color},{default:p((()=>[(c(),f(C(a.icon)))])),_:2},1032,["color"])],4),u("div",A,[u("div",E,w(a.title),1),u("div",T,w(a.value),1),u("div",H,[t[1]||(t[1]=_(" 较昨日 ")),u("span",{class:x(a.trend>=0?"up":"down")},[_(w(Math.abs(a.trend))+"% ",1),h(r,null,{default:p((()=>[(c(),f(C(a.trend>=0?"CaretTop":"CaretBottom")))])),_:2},1024)],2)])])])])),_:2},1024)])),_:2},1024)))),128))])),_:1}),u("div",O,[h(d,{gutter:20,class:"charts-row"},{default:p((()=>[h(l,{span:16},{default:p((()=>[h(s,{class:"chart-card"},{header:p((()=>[u("div",j,[t[4]||(t[4]=u("span",{class:"title"},"出入库趋势",-1)),h(i,{modelValue:J.value,"onUpdate:modelValue":t[0]||(t[0]=a=>J.value=a),size:"small"},{default:p((()=>[h(o,{label:"week"},{default:p((()=>t[2]||(t[2]=[_("本周")]))),_:1}),h(o,{label:"month"},{default:p((()=>t[3]||(t[3]=[_("本月")]))),_:1})])),_:1},8,["modelValue"])])])),default:p((()=>[u("div",{ref_key:"stockTrendChart",ref:U,style:{height:"350px"}},null,512)])),_:1})])),_:1}),h(l,{span:8},{default:p((()=>[h(s,{class:"chart-card"},{header:p((()=>t[5]||(t[5]=[u("div",{class:"chart-header"},[u("span",{class:"title"},"库存分类占比")],-1)]))),default:p((()=>[u("div",{ref_key:"stockTypeChart",ref:B,style:{height:"350px"}},null,512)])),_:1})])),_:1})])),_:1}),h(d,{gutter:20,class:"charts-row"},{default:p((()=>[h(l,{span:12},{default:p((()=>[h(s,{class:"chart-card"},{header:p((()=>[u("div",F,[t[7]||(t[7]=u("span",{class:"title"},"库位使用率",-1)),(e.state.dashboard.usage?Math.max(...e.state.dashboard.usage.map((a=>a.value))):0)>=90?(c(),f(y,{key:0,type:"danger",size:"small"},{default:p((()=>t[6]||(t[6]=[_("库位紧张")]))),_:1})):z("",!0)])])),default:p((()=>[u("div",{ref_key:"locationUsageChart",ref:M,style:{height:"300px"}},null,512)])),_:1})])),_:1}),h(l,{span:12},{default:p((()=>[h(s,{class:"chart-card"},{header:p((()=>[u("div",V,[t[8]||(t[8]=u("span",{class:"title"},"告警统计",-1)),h(y,{type:S(e).state.dashboard.alarmStats.severe>0?"danger":"success",size:"small"},{default:p((()=>[_(w(S(e).state.dashboard.alarmStats.severe)+"个严重告警 ",1)])),_:1},8,["type"])])])),default:p((()=>[u("div",{ref_key:"alarmStatChart",ref:P,style:{height:"300px"}},null,512)])),_:1})])),_:1})])),_:1}),h(d,{gutter:20,class:"charts-row"},{default:p((()=>[h(l,{span:24},{default:p((()=>[h(s,{class:"chart-card"},{header:p((()=>[u("div",D,[t[10]||(t[10]=u("span",{class:"title"},"实时告警",-1)),h(W,{type:"primary",link:""},{default:p((()=>t[9]||(t[9]=[_("查看全部")]))),_:1})])])),default:p((()=>[h(G,{data:S(e).state.dashboard.alarms,style:{width:"100%"},size:"large"},{default:p((()=>[h(X,{prop:"time",label:"时间",width:"180"}),h(X,{prop:"title",label:"告警标题",width:"200"}),h(X,{prop:"content",label:"告警内容"}),h(X,{prop:"location",label:"位置",width:"150"}),h(X,{prop:"level",label:"级别",width:"100"},{default:p((({row:a})=>[h(y,{type:"严重"===a.level?"danger":"warning"},{default:p((()=>[_(w(a.level),1)])),_:2},1032,["type"])])),_:1})])),_:1},8,["data"])])),_:1})])),_:1})])),_:1})])])}}}),[["__scopeId","data-v-e5135c3f"]]);export{U as default};
