import{r as e,c as a,w as l,a1 as t,o as u,f as o,k as r,g as s,x as d,j as n,V as i,Y as c,y as p,u as v,Z as m,R as g,S as f,I as y,_ as b,$ as h,e as w,J as _,X as k,a0 as V}from"./element-plus-D3gz1akn.js";import{s as N,a as C}from"./index-B95quUki.js";import{_ as x}from"./_plugin-vue_export-helper-BCo6x5W8.js";const q={class:"inbound"},I={class:"toolbar"},T={class:"search-area"},U={class:"pagination"},D={class:"dialog-footer"},z={name:"Inbound"},j=x(Object.assign(z,{setup(x){const z=e(!1),j=e([]),B=e([]),S=e(1),$=e(10),L=e(0),O=["电子产品","服装","食品","家具","其他"],R=[{label:"待入库",value:"待入库"},{label:"已入库",value:"已入库"},{label:"已取消",value:"已取消"}],J=e({keyword:"",status:""}),P=e(!1),X=e(null),Y=e({productName:"",category:"",quantity:1,operator:"管理员"}),Z={productName:[{required:!0,message:"请输入商品名称",trigger:"blur"}],category:[{required:!0,message:"请选择商品分类",trigger:"change"}],quantity:[{required:!0,message:"请输入数量",trigger:"blur"}],operator:[{required:!0,message:"请输入操作人",trigger:"blur"}]},A=e("add"),E=a((()=>"add"===A.value?"新增入库":"编辑入库")),F=async()=>{z.value=!0;try{if(N.state.inbound.list.length>0)j.value=N.state.inbound.list,H();else{const{data:e}=await C.get("/api/inbound/list");200===e.code&&(j.value=e.data,N.setInboundData(e.data,e.data.length),H())}}catch(e){i.error("获取入库单列表失败")}z.value=!1},G=()=>{A.value="add",Y.value={productName:"",category:"",quantity:1,operator:"管理员"},P.value=!0},H=()=>{if(!j.value.length)return;let e=j.value;(J.value.keyword||J.value.status)&&(e=j.value.filter((e=>{const a=!J.value.keyword||e.productName.toLowerCase().includes(J.value.keyword.toLowerCase())||e.orderNo.toLowerCase().includes(J.value.keyword.toLowerCase()),l=!J.value.status||e.status===J.value.status;return a&&l}))),L.value=e.length;const a=(S.value-1)*$.value,l=a+$.value;B.value=e.slice(a,l)},K=async()=>{X.value&&await X.value.validate((e=>{if(e){if("add"===A.value){const e={id:Date.now(),...Y.value,orderNo:`IN${Date.now()}`,status:"待入库",createTime:(new Date).toISOString()};j.value=[e,...j.value]}else j.value=j.value.map((e=>e.id===Y.value.id?{...e,...Y.value,orderNo:e.orderNo,status:e.status,createTime:e.createTime}:e));N.setInboundData(j.value,j.value.length),H(),i.success("add"===A.value?"添加成功":"更新成功"),P.value=!1}}))},M=e=>{$.value=e,H()},Q=e=>{S.value=e,H()};return l([()=>J.value.keyword,()=>J.value.status],(()=>{S.value=1,H()})),t((()=>{F()})),u((()=>{F()})),(e,a)=>{const l=n("el-icon"),t=n("el-input"),u=n("el-option"),C=n("el-select"),x=n("el-button"),F=n("el-card"),W=n("el-table-column"),ee=n("el-tag"),ae=n("el-table"),le=n("el-pagination"),te=n("el-form-item"),ue=n("el-input-number"),oe=n("el-form"),re=n("el-dialog"),se=c("loading");return r(),o("div",q,[s(F,{class:"toolbar-card"},{default:d((()=>[p("div",I,[p("div",T,[s(t,{modelValue:J.value.keyword,"onUpdate:modelValue":a[0]||(a[0]=e=>J.value.keyword=e),placeholder:"搜索商品名称/订单号",class:"search-input",clearable:""},{prefix:d((()=>[s(l,null,{default:d((()=>[s(v(m))])),_:1})])),_:1},8,["modelValue"]),s(C,{modelValue:J.value.status,"onUpdate:modelValue":a[1]||(a[1]=e=>J.value.status=e),placeholder:"订单状态",clearable:"",class:"status-select"},{default:d((()=>[(r(),o(g,null,f(R,(e=>s(u,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])]),s(x,{type:"primary",onClick:G},{default:d((()=>[s(l,null,{default:d((()=>[s(v(b))])),_:1}),a[10]||(a[10]=y("新增入库 "))])),_:1})])])),_:1}),s(F,{class:"table-card"},{default:d((()=>[h((r(),w(ae,{data:B.value,style:{width:"100%"},size:"large",border:""},{default:d((()=>[s(W,{prop:"orderNo",label:"订单编号",width:"150"}),s(W,{prop:"productName",label:"商品名称","min-width":"200","show-overflow-tooltip":""}),s(W,{prop:"category",label:"分类",width:"120"}),s(W,{prop:"quantity",label:"数量",width:"100",align:"right"}),s(W,{prop:"operator",label:"操作人",width:"120"}),s(W,{prop:"status",label:"状态",width:"100"},{default:d((({row:e})=>{return[s(ee,{type:(a=e.status,{"待入库":"warning","已入库":"success","已取消":"info"}[a])},{default:d((()=>[y(_(e.status),1)])),_:2},1032,["type"])];var a})),_:1}),s(W,{prop:"createTime",label:"创建时间",width:"180"}),s(W,{label:"操作",width:"220",fixed:"right"},{default:d((({row:e})=>["待入库"===e.status?(r(),w(x,{key:0,type:"success",link:"",onClick:a=>(e=>{V.confirm(`确认入库订单"${e.orderNo}"？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{j.value=j.value.map((a=>a.id===e.id?{...a,status:"已入库"}:a)),N.setInboundData(j.value,j.value.length),H(),i.success("入库成功")})).catch((()=>{}))})(e)},{default:d((()=>a[11]||(a[11]=[y(" 确认入库 ")]))),_:2},1032,["onClick"])):k("",!0),"待入库"===e.status?(r(),w(x,{key:1,type:"danger",link:"",onClick:a=>(e=>{V.confirm(`确定要取消入库订单"${e.orderNo}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{j.value=j.value.map((a=>a.id===e.id?{...a,status:"已取消"}:a)),N.setInboundData(j.value,j.value.length),H(),i.success("取消成功")})).catch((()=>{}))})(e)},{default:d((()=>a[12]||(a[12]=[y(" 取消入库 ")]))),_:2},1032,["onClick"])):k("",!0),s(x,{type:"primary",link:"",onClick:a=>(e=>{A.value="edit",Y.value={id:e.id,productName:e.productName,category:e.category,quantity:e.quantity,operator:e.operator},P.value=!0})(e)},{default:d((()=>a[13]||(a[13]=[y(" 编辑 ")]))),_:2},1032,["onClick"]),s(x,{type:"danger",link:"",onClick:a=>(e=>{V.confirm(`确定要删除入库单"${e.orderNo}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{j.value=j.value.filter((a=>a.id!==e.id)),N.setInboundData(j.value,j.value.length),H(),i.success("删除成功")})).catch((()=>{}))})(e)},{default:d((()=>a[14]||(a[14]=[y(" 删除 ")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[se,z.value]]),p("div",U,[s(le,{"current-page":S.value,"onUpdate:currentPage":a[2]||(a[2]=e=>S.value=e),"page-size":$.value,"onUpdate:pageSize":a[3]||(a[3]=e=>$.value=e),"page-sizes":[10,20,50,100],total:L.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:M,onCurrentChange:Q},null,8,["current-page","page-size","total"])])])),_:1}),s(re,{modelValue:P.value,"onUpdate:modelValue":a[9]||(a[9]=e=>P.value=e),title:E.value,width:"500px","destroy-on-close":""},{footer:d((()=>[p("div",D,[s(x,{onClick:a[8]||(a[8]=e=>P.value=!1)},{default:d((()=>a[15]||(a[15]=[y("取消")]))),_:1}),s(x,{type:"primary",onClick:K},{default:d((()=>a[16]||(a[16]=[y("确定")]))),_:1})])])),default:d((()=>[s(oe,{ref_key:"formRef",ref:X,model:Y.value,rules:Z,"label-width":"100px",class:"dialog-form"},{default:d((()=>[s(te,{label:"商品名称",prop:"productName"},{default:d((()=>[s(t,{modelValue:Y.value.productName,"onUpdate:modelValue":a[4]||(a[4]=e=>Y.value.productName=e),placeholder:"请输入商品名称"},null,8,["modelValue"])])),_:1}),s(te,{label:"商品分类",prop:"category"},{default:d((()=>[s(C,{modelValue:Y.value.category,"onUpdate:modelValue":a[5]||(a[5]=e=>Y.value.category=e),placeholder:"请选择分类",class:"form-select"},{default:d((()=>[(r(),o(g,null,f(O,(e=>s(u,{key:e,label:e,value:e},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])),_:1}),s(te,{label:"数量",prop:"quantity"},{default:d((()=>[s(ue,{modelValue:Y.value.quantity,"onUpdate:modelValue":a[6]||(a[6]=e=>Y.value.quantity=e),min:1,class:"form-number"},null,8,["modelValue"])])),_:1}),s(te,{label:"操作人",prop:"operator"},{default:d((()=>[s(t,{modelValue:Y.value.operator,"onUpdate:modelValue":a[7]||(a[7]=e=>Y.value.operator=e),placeholder:"请输入操作人"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-75bb1b31"]]);export{j as default};
