import{r as e,o as a,w as l,f as t,k as u,g as o,x as r,j as n,V as d,Y as s,y as i,u as c,Z as v,R as p,S as m,I as g,_ as y,$ as f,e as b,J as h,a0 as w}from"./element-plus-D3gz1akn.js";import{s as _,a as V}from"./index-B95quUki.js";import{_ as k}from"./_plugin-vue_export-helper-BCo6x5W8.js";const C={class:"inventory"},q={class:"toolbar"},x={class:"search-area"},U={class:"pagination"},I={class:"dialog-footer"},z={name:"Inventory"},j=k(Object.assign(z,{setup(k){const z=e(!1),j=e([]),D=e([]),S=e(1),L=e(10),T=e(0),$=["电子产品","服装","食品","家具","其他"],B=e({keyword:"",category:""}),O=e(!1),R=e("add"),F=e(null),H=e({name:"",category:"",location:"",quantity:0,price:0,status:"正常"}),J={name:[{required:!0,message:"请输入商品名称",trigger:"blur"}],category:[{required:!0,message:"请选择商品分类",trigger:"change"}],location:[{required:!0,message:"请输入库位",trigger:"blur"}],quantity:[{required:!0,message:"请输入数量",trigger:"blur"}],price:[{required:!0,message:"请输入单价",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},M=()=>{if(!j.value.length)return;let e=j.value;(B.value.keyword||B.value.category)&&(e=j.value.filter((e=>{const a=!B.value.keyword||e.name.toLowerCase().includes(B.value.keyword.toLowerCase())||e.code.toLowerCase().includes(B.value.keyword.toLowerCase()),l=!B.value.category||e.category===B.value.category;return a&&l}))),T.value=e.length;const a=(S.value-1)*L.value,l=a+L.value;D.value=e.slice(a,l)},P=()=>{R.value="add",H.value={name:"",category:"",location:"",quantity:0,price:0,status:"正常"},O.value=!0},W=async()=>{F.value&&await F.value.validate((e=>{if(e){if("add"===R.value){const e={id:Date.now(),...H.value,code:`WH${Math.random().toString().slice(2,8)}`,createTime:(new Date).toISOString()};j.value=[e,...j.value],_.setInventoryData(j.value,j.value.length)}else j.value=j.value.map((e=>e.id===H.value.id?{...e,...H.value}:e)),_.setInventoryData(j.value,j.value.length);M(),d.success("add"===R.value?"添加成功":"更新成功"),O.value=!1}}))},Y=e=>{L.value=e,M()},Z=e=>{S.value=e,M()};return a((()=>{_.state.inventory.list.length?(j.value=_.state.inventory.list,M()):(async()=>{z.value=!0;try{const{data:e}=await V.get("/api/inventory/list");200===e.code&&(j.value=e.data,_.setInventoryData(e.data,e.data.length),M())}catch(e){d.error("获取库存列表失败")}z.value=!1})()})),l([()=>B.value.keyword,()=>B.value.category],(()=>{S.value=1,M()})),(e,a)=>{const l=n("el-icon"),V=n("el-input"),k=n("el-option"),A=n("el-select"),E=n("el-button"),G=n("el-card"),K=n("el-table-column"),N=n("el-tag"),Q=n("el-table"),X=n("el-pagination"),ee=n("el-form-item"),ae=n("el-input-number"),le=n("el-form"),te=n("el-dialog"),ue=s("loading");return u(),t("div",C,[o(G,{class:"toolbar-card"},{default:r((()=>[i("div",q,[i("div",x,[o(V,{modelValue:B.value.keyword,"onUpdate:modelValue":a[0]||(a[0]=e=>B.value.keyword=e),placeholder:"搜索商品名称/编号",class:"search-input",clearable:""},{prefix:r((()=>[o(l,null,{default:r((()=>[o(c(v))])),_:1})])),_:1},8,["modelValue"]),o(A,{modelValue:B.value.category,"onUpdate:modelValue":a[1]||(a[1]=e=>B.value.category=e),placeholder:"商品分类",clearable:"",class:"category-select"},{default:r((()=>[(u(),t(p,null,m($,(e=>o(k,{key:e,label:e,value:e},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])]),o(E,{type:"primary",onClick:P},{default:r((()=>[o(l,null,{default:r((()=>[o(c(y))])),_:1}),a[12]||(a[12]=g("新增商品 "))])),_:1})])])),_:1}),o(G,{class:"table-card"},{default:r((()=>[f((u(),b(Q,{data:D.value,style:{width:"100%"},size:"large",border:""},{default:r((()=>[o(K,{prop:"code",label:"商品编号",width:"150"}),o(K,{prop:"name",label:"商品名称","min-width":"200","show-overflow-tooltip":""}),o(K,{prop:"category",label:"分类",width:"120"}),o(K,{prop:"location",label:"库位",width:"120"}),o(K,{prop:"quantity",label:"库存量",width:"100",align:"right"}),o(K,{prop:"price",label:"单价",width:"120",align:"right"},{default:r((({row:e})=>[g(" ￥"+h(e.price.toFixed(2)),1)])),_:1}),o(K,{prop:"status",label:"状态",width:"100"},{default:r((({row:e})=>{return[o(N,{type:(a=e.status,{"正常":"success","待检":"warning","报废":"danger"}[a])},{default:r((()=>[g(h(e.status),1)])),_:2},1032,["type"])];var a})),_:1}),o(K,{prop:"createTime",label:"创建时间",width:"180"}),o(K,{label:"操作",width:"150",fixed:"right"},{default:r((({row:e})=>[o(E,{type:"primary",link:"",onClick:a=>(e=>{R.value="edit",H.value={...e},O.value=!0})(e)},{default:r((()=>a[13]||(a[13]=[g(" 编辑 ")]))),_:2},1032,["onClick"]),o(E,{type:"danger",link:"",onClick:a=>(e=>{w.confirm(`确定要删除商品"${e.name}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{j.value=j.value.filter((a=>a.id!==e.id)),_.setInventoryData(j.value,j.value.length),M(),d.success("删除成功")})).catch((()=>{}))})(e)},{default:r((()=>a[14]||(a[14]=[g(" 删除 ")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[ue,z.value]]),i("div",U,[o(X,{"current-page":S.value,"onUpdate:currentPage":a[2]||(a[2]=e=>S.value=e),"page-size":L.value,"onUpdate:pageSize":a[3]||(a[3]=e=>L.value=e),"page-sizes":[10,20,50,100],total:T.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Y,onCurrentChange:Z},null,8,["current-page","page-size","total"])])])),_:1}),o(te,{modelValue:O.value,"onUpdate:modelValue":a[11]||(a[11]=e=>O.value=e),title:"add"===R.value?"新增商品":"编辑商品",width:"500px","destroy-on-close":""},{footer:r((()=>[i("div",I,[o(E,{onClick:a[10]||(a[10]=e=>O.value=!1)},{default:r((()=>a[15]||(a[15]=[g("取消")]))),_:1}),o(E,{type:"primary",onClick:W},{default:r((()=>a[16]||(a[16]=[g("确定")]))),_:1})])])),default:r((()=>[o(le,{ref_key:"formRef",ref:F,model:H.value,rules:J,"label-width":"100px",class:"dialog-form"},{default:r((()=>[o(ee,{label:"商品名称",prop:"name"},{default:r((()=>[o(V,{modelValue:H.value.name,"onUpdate:modelValue":a[4]||(a[4]=e=>H.value.name=e),placeholder:"请输入商品名称"},null,8,["modelValue"])])),_:1}),o(ee,{label:"商品分类",prop:"category"},{default:r((()=>[o(A,{modelValue:H.value.category,"onUpdate:modelValue":a[5]||(a[5]=e=>H.value.category=e),placeholder:"请选择分类",class:"form-select"},{default:r((()=>[(u(),t(p,null,m($,(e=>o(k,{key:e,label:e,value:e},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])),_:1}),o(ee,{label:"库位",prop:"location"},{default:r((()=>[o(V,{modelValue:H.value.location,"onUpdate:modelValue":a[6]||(a[6]=e=>H.value.location=e),placeholder:"请输入库位"},null,8,["modelValue"])])),_:1}),o(ee,{label:"数量",prop:"quantity"},{default:r((()=>[o(ae,{modelValue:H.value.quantity,"onUpdate:modelValue":a[7]||(a[7]=e=>H.value.quantity=e),min:0,class:"form-number"},null,8,["modelValue"])])),_:1}),o(ee,{label:"单价",prop:"price"},{default:r((()=>[o(ae,{modelValue:H.value.price,"onUpdate:modelValue":a[8]||(a[8]=e=>H.value.price=e),min:0,precision:2,step:.1,class:"form-number"},null,8,["modelValue"])])),_:1}),o(ee,{label:"状态",prop:"status"},{default:r((()=>[o(A,{modelValue:H.value.status,"onUpdate:modelValue":a[9]||(a[9]=e=>H.value.status=e),class:"form-select"},{default:r((()=>[o(k,{label:"正常",value:"正常"}),o(k,{label:"待检",value:"待检"}),o(k,{label:"报废",value:"报废"})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-cc083c12"]]);export{j as default};
