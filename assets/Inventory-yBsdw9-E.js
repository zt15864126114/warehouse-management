import{r as d,o as le,w as te,f as S,k as C,g as a,x as t,j as u,V as I,Y as oe,y as x,u as $,Z as ne,R as E,S as M,I as m,_ as re,$ as ue,e as se,J as j,a0 as de}from"./element-plus-D9U92kps.js";import{s as _,a as ie}from"./index-Bk0e3mkj.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";const pe={class:"inventory"},ve={class:"toolbar"},me={class:"search-area"},ge={class:"pagination"},fe={class:"dialog-footer"},_e={name:"Inventory"},ye=Object.assign(_e,{setup(be){const D=d(!1),r=d([]),U=d([]),y=d(1),b=d(10),z=d(0),B=["电子产品","服装","食品","家具","其他"],s=d({keyword:"",category:""}),g=d(!1),w=d("add"),q=d(null),n=d({name:"",category:"",location:"",quantity:0,price:0,status:"正常"}),F={name:[{required:!0,message:"请输入商品名称",trigger:"blur"}],category:[{required:!0,message:"请选择商品分类",trigger:"change"}],location:[{required:!0,message:"请输入库位",trigger:"blur"}],quantity:[{required:!0,message:"请输入数量",trigger:"blur"}],price:[{required:!0,message:"请输入单价",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},N=async()=>{D.value=!0;try{const{data:o}=await ie.get("/api/inventory/list");o.code===200&&(r.value=o.data,_.setInventoryData(o.data,o.data.length),c())}catch(o){console.error("获取库存列表失败:",o),I.error("获取库存列表失败")}D.value=!1},P=o=>({正常:"success",待检:"warning",报废:"danger"})[o],c=()=>{if(!r.value.length)return;let o=r.value;(s.value.keyword||s.value.category)&&(o=r.value.filter(p=>{const v=!s.value.keyword||p.name.toLowerCase().includes(s.value.keyword.toLowerCase())||p.code.toLowerCase().includes(s.value.keyword.toLowerCase()),V=!s.value.category||p.category===s.value.category;return v&&V})),z.value=o.length;const e=(y.value-1)*b.value,k=e+b.value;U.value=o.slice(e,k)},R=()=>{y.value=1,c()},O=()=>{w.value="add",n.value={name:"",category:"",location:"",quantity:0,price:0,status:"正常"},g.value=!0},A=o=>{w.value="edit",n.value={...o},g.value=!0},H=o=>{de.confirm(`确定要删除商品"${o.name}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{r.value=r.value.filter(e=>e.id!==o.id),_.setInventoryData(r.value,r.value.length),c(),I.success("删除成功")}).catch(()=>{})},J=async()=>{q.value&&await q.value.validate(o=>{if(o){if(w.value==="add"){const e={id:Date.now(),...n.value,code:`WH${Math.random().toString().slice(2,8)}`,createTime:new Date().toISOString()};r.value=[e,...r.value],_.setInventoryData(r.value,r.value.length)}else r.value=r.value.map(e=>e.id===n.value.id?{...e,...n.value}:e),_.setInventoryData(r.value,r.value.length);c(),I.success(w.value==="add"?"添加成功":"更新成功"),g.value=!1}})},K=o=>{b.value=o,c()},W=o=>{y.value=o,c()};return le(()=>{_.state.inventory.list.length?(r.value=_.state.inventory.list,c()):N()}),te([()=>s.value.keyword,()=>s.value.category],()=>{R()}),(o,e)=>{const k=u("el-icon"),p=u("el-input"),v=u("el-option"),V=u("el-select"),h=u("el-button"),T=u("el-card"),i=u("el-table-column"),Y=u("el-tag"),Z=u("el-table"),G=u("el-pagination"),f=u("el-form-item"),L=u("el-input-number"),Q=u("el-form"),X=u("el-dialog"),ee=oe("loading");return C(),S("div",pe,[a(T,{class:"toolbar-card"},{default:t(()=>[x("div",ve,[x("div",me,[a(p,{modelValue:s.value.keyword,"onUpdate:modelValue":e[0]||(e[0]=l=>s.value.keyword=l),placeholder:"搜索商品名称/编号",class:"search-input",clearable:""},{prefix:t(()=>[a(k,null,{default:t(()=>[a($(ne))]),_:1})]),_:1},8,["modelValue"]),a(V,{modelValue:s.value.category,"onUpdate:modelValue":e[1]||(e[1]=l=>s.value.category=l),placeholder:"商品分类",clearable:"",class:"category-select"},{default:t(()=>[(C(),S(E,null,M(B,l=>a(v,{key:l,label:l,value:l},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),a(h,{type:"primary",onClick:O},{default:t(()=>[a(k,null,{default:t(()=>[a($(re))]),_:1}),e[12]||(e[12]=m("新增商品 "))]),_:1})])]),_:1}),a(T,{class:"table-card"},{default:t(()=>[ue((C(),se(Z,{data:U.value,style:{width:"100%"},size:"large",border:""},{default:t(()=>[a(i,{prop:"code",label:"商品编号",width:"150"}),a(i,{prop:"name",label:"商品名称","min-width":"200","show-overflow-tooltip":""}),a(i,{prop:"category",label:"分类",width:"120"}),a(i,{prop:"location",label:"库位",width:"120"}),a(i,{prop:"quantity",label:"库存量",width:"100",align:"right"}),a(i,{prop:"price",label:"单价",width:"120",align:"right"},{default:t(({row:l})=>[m(" ￥"+j(l.price.toFixed(2)),1)]),_:1}),a(i,{prop:"status",label:"状态",width:"100"},{default:t(({row:l})=>[a(Y,{type:P(l.status)},{default:t(()=>[m(j(l.status),1)]),_:2},1032,["type"])]),_:1}),a(i,{prop:"createTime",label:"创建时间",width:"180"}),a(i,{label:"操作",width:"150",fixed:"right"},{default:t(({row:l})=>[a(h,{type:"primary",link:"",onClick:ae=>A(l)},{default:t(()=>e[13]||(e[13]=[m(" 编辑 ")])),_:2},1032,["onClick"]),a(h,{type:"danger",link:"",onClick:ae=>H(l)},{default:t(()=>e[14]||(e[14]=[m(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ee,D.value]]),x("div",ge,[a(G,{"current-page":y.value,"onUpdate:currentPage":e[2]||(e[2]=l=>y.value=l),"page-size":b.value,"onUpdate:pageSize":e[3]||(e[3]=l=>b.value=l),"page-sizes":[10,20,50,100],total:z.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:K,onCurrentChange:W},null,8,["current-page","page-size","total"])])]),_:1}),a(X,{modelValue:g.value,"onUpdate:modelValue":e[11]||(e[11]=l=>g.value=l),title:w.value==="add"?"新增商品":"编辑商品",width:"500px","destroy-on-close":""},{footer:t(()=>[x("div",fe,[a(h,{onClick:e[10]||(e[10]=l=>g.value=!1)},{default:t(()=>e[15]||(e[15]=[m("取消")])),_:1}),a(h,{type:"primary",onClick:J},{default:t(()=>e[16]||(e[16]=[m("确定")])),_:1})])]),default:t(()=>[a(Q,{ref_key:"formRef",ref:q,model:n.value,rules:F,"label-width":"100px",class:"dialog-form"},{default:t(()=>[a(f,{label:"商品名称",prop:"name"},{default:t(()=>[a(p,{modelValue:n.value.name,"onUpdate:modelValue":e[4]||(e[4]=l=>n.value.name=l),placeholder:"请输入商品名称"},null,8,["modelValue"])]),_:1}),a(f,{label:"商品分类",prop:"category"},{default:t(()=>[a(V,{modelValue:n.value.category,"onUpdate:modelValue":e[5]||(e[5]=l=>n.value.category=l),placeholder:"请选择分类",class:"form-select"},{default:t(()=>[(C(),S(E,null,M(B,l=>a(v,{key:l,label:l,value:l},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(f,{label:"库位",prop:"location"},{default:t(()=>[a(p,{modelValue:n.value.location,"onUpdate:modelValue":e[6]||(e[6]=l=>n.value.location=l),placeholder:"请输入库位"},null,8,["modelValue"])]),_:1}),a(f,{label:"数量",prop:"quantity"},{default:t(()=>[a(L,{modelValue:n.value.quantity,"onUpdate:modelValue":e[7]||(e[7]=l=>n.value.quantity=l),min:0,class:"form-number"},null,8,["modelValue"])]),_:1}),a(f,{label:"单价",prop:"price"},{default:t(()=>[a(L,{modelValue:n.value.price,"onUpdate:modelValue":e[8]||(e[8]=l=>n.value.price=l),min:0,precision:2,step:.1,class:"form-number"},null,8,["modelValue"])]),_:1}),a(f,{label:"状态",prop:"status"},{default:t(()=>[a(V,{modelValue:n.value.status,"onUpdate:modelValue":e[9]||(e[9]=l=>n.value.status=l),class:"form-select"},{default:t(()=>[a(v,{label:"正常",value:"正常"}),a(v,{label:"待检",value:"待检"}),a(v,{label:"报废",value:"报废"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),ke=ce(ye,[["__scopeId","data-v-cc083c12"]]);export{ke as default};
