import{r as e,c as l,a1 as a,o as t,f as n,k as o,e as r,X as i,g as s,y as u,j as c,x as d,V as p,Y as v,R as g,S as m,J as f,I as y,$ as h,u as _,a2 as b,_ as w,a3 as k,F as C,a4 as V,L as x,a5 as M,a6 as T,a7 as $,a8 as D,a0 as B}from"./element-plus-D3gz1akn.js";import{f as I,s as U}from"./index-B95quUki.js";import{_ as S}from"./_plugin-vue_export-helper-BCo6x5W8.js";const j={class:"monitoring"},F={class:"stats-header"},R={class:"stats-content"},q={class:"stats-label"},z={class:"filter-bar"},A={class:"card-header"},H={class:"header-left"},O={class:"header-actions"},P={class:"card-header"},X={class:"header-left"},E={class:"header-actions"},L={class:"camera-preview"},J={class:"camera-placeholder large"},W={class:"camera-info"},Y={class:"camera-controls"},Z={class:"control-group"},G={class:"control-group"},K={class:"dialog-footer"},N={name:"Monitoring"},Q=S(Object.assign(N,{setup(S){const N=e(!1),Q=e([]),ee=e([]),le=e(!1),ae=e(null),te=e(!1),ne=e({name:"",location:"",type:"海康威视球机"}),oe=e(null),re=["海康威视球机","大华枪机","海康威视枪机","大华球机","萤石云摄像头"],ie={name:[{required:!0,message:"请输入设备名称",trigger:"blur"},{pattern:/^IPC-[A-Z]\d-\d{2}$/,message:"设备名称格式应为 IPC-X0-00",trigger:"blur"}],location:[{required:!0,message:"请输入安装位置",trigger:"blur"}],type:[{required:!0,message:"请选择设备类型",trigger:"change"}]},se=e(""),ue=e(I.monitoring.areas);e(I.monitoring.inspectionTasks);const ce=l((()=>ee.value[0])),de=l((()=>[{title:"设备总数",value:Q.value.length,percentage:Math.round(Q.value.filter((e=>"在线"===e.status)).length/Q.value.length*100),label:"在线率",type:"primary",color:"#409EFF"},{title:"设备健康度",value:I.monitoring.stats.deviceHealth+"%",percentage:I.monitoring.stats.deviceHealth,label:"健康评分",type:"success",color:"#67C23A"},{title:"告警统计",value:ee.value.length,percentage:100-Math.round(ee.value.filter((e=>"严重"===e.level)).length/ee.value.length*100),label:"告警处理率",type:"warning",color:"#E6A23C"},{title:"维护计划",value:I.monitoring.stats.maintenanceRate+"%",percentage:I.monitoring.stats.maintenanceRate,label:"计划完成率",type:"info",color:"#909399"}])),pe=()=>{N.value=!0;try{Q.value=[...I.monitoring.cameras],ee.value=[...I.monitoring.alarms],U.setMonitoringData(Q.value,ee.value),N.value=!1}catch(e){p.error("获取监控数据失败"),N.value=!1}},ve=e=>"在线"===e?"success":"danger",ge=e=>({"严重":"danger","警告":"warning","提示":"info"}[e]),me=e=>{Q.value=e?I.monitoring.cameras.filter((l=>l.location.startsWith(e))):[...I.monitoring.cameras]};a((()=>{pe()})),t((()=>{pe()}));const fe=()=>{pe(),p.success("刷新成功")},ye=()=>{B.confirm("确认清空所有已处理的告警记录？","清空确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{ee.value=ee.value.filter((e=>"processed"!==e.status)),U.setMonitoringData(Q.value,ee.value),p.success("已清空处理记录")})).catch((()=>{}))},he=()=>{ne.value={name:"",location:"",type:"海康威视球机"},te.value=!0},_e=async()=>{oe.value&&await oe.value.validate((e=>{if(e){const e={id:Date.now(),...ne.value,status:"在线",lastMaintenance:(new Date).toISOString().split("T")[0]};Q.value=[e,...Q.value],U.setMonitoringData(Q.value,ee.value),p.success("添加成功"),te.value=!1}}))};return(e,l)=>{var a;const t=c("el-alert"),I=c("el-tag"),S=c("el-progress"),pe=c("el-card"),be=c("el-col"),we=c("el-row"),ke=c("el-option"),Ce=c("el-select"),Ve=c("el-icon"),xe=c("el-button"),Me=c("el-table-column"),Te=c("el-table"),$e=c("el-button-group"),De=c("el-dialog"),Be=c("el-input"),Ie=c("el-form-item"),Ue=c("el-form"),Se=v("loading");return o(),n("div",j,[ce.value?(o(),r(t,{key:0,title:ce.value.title,description:ce.value.content,type:ge(ce.value.level),"show-icon":"",closable:!1,class:"alert-banner"},null,8,["title","description","type"])):i("",!0),s(we,{gutter:20,class:"stats-row"},{default:d((()=>[(o(!0),n(g,null,m(de.value,(e=>(o(),r(be,{span:6,key:e.title},{default:d((()=>[s(pe,{class:"stats-card"},{header:d((()=>[u("div",F,[u("span",null,f(e.title),1),s(I,{type:e.type},{default:d((()=>[y(f(e.value),1)])),_:2},1032,["type"])])])),default:d((()=>[u("div",R,[s(S,{type:"dashboard",percentage:e.percentage,color:e.color},null,8,["percentage","color"]),u("div",q,f(e.label),1)])])),_:2},1024)])),_:2},1024)))),128))])),_:1}),u("div",z,[s(Ce,{modelValue:se.value,"onUpdate:modelValue":l[0]||(l[0]=e=>se.value=e),placeholder:"选择区域",clearable:"",class:"area-select",onChange:me},{default:d((()=>[(o(!0),n(g,null,m(ue.value,(e=>(o(),r(ke,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),s(pe,{class:"camera-card"},{header:d((()=>[u("div",A,[u("div",H,[l[7]||(l[7]=u("span",{class:"title"},"监控点位",-1)),s(I,{type:"success"},{default:d((()=>[y(f(Q.value.filter((e=>"在线"===e.status)).length)+" 在线",1)])),_:1}),s(I,{type:"danger"},{default:d((()=>[y(f(Q.value.filter((e=>"离线"===e.status)).length)+" 离线",1)])),_:1})]),u("div",O,[s(xe,{type:"primary",link:"",onClick:fe},{default:d((()=>[s(Ve,null,{default:d((()=>[s(_(b))])),_:1}),l[8]||(l[8]=y("刷新 "))])),_:1}),s(xe,{type:"primary",onClick:he},{default:d((()=>[s(Ve,null,{default:d((()=>[s(_(w))])),_:1}),l[9]||(l[9]=y("添加监控点 "))])),_:1})])])])),default:d((()=>[h((o(),r(Te,{data:Q.value,style:{width:"100%"},size:"large",border:""},{default:d((()=>[s(Me,{prop:"name",label:"监控点名称","min-width":"180"}),s(Me,{prop:"location",label:"位置",width:"150"}),s(Me,{prop:"type",label:"设备类型",width:"150"}),s(Me,{prop:"status",label:"状态",width:"100"},{default:d((({row:e})=>[s(I,{type:ve(e.status)},{default:d((()=>[y(f(e.status),1)])),_:2},1032,["type"])])),_:1}),s(Me,{prop:"lastMaintenance",label:"最后维护时间",width:"180"}),s(Me,{label:"操作",width:"180",fixed:"right"},{default:d((({row:e})=>[s(xe,{type:"primary",link:"",onClick:l=>{return a=e,ae.value={...a},void(le.value=!0);var a}},{default:d((()=>l[10]||(l[10]=[y("查看")]))),_:2},1032,["onClick"]),s(xe,{type:"warning",link:"",onClick:l=>{return a=e,void B.confirm(`确认对设备 ${a.name} 进行维护？`,"维护确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={...a,lastMaintenance:(new Date).toISOString().split("T")[0]};Q.value=Q.value.map((l=>l.id===a.id?e:l)),U.setMonitoringData(Q.value,ee.value),p.success("维护记录已更新")})).catch((()=>{}));var a}},{default:d((()=>l[11]||(l[11]=[y("维护")]))),_:2},1032,["onClick"]),s(xe,{type:"danger",link:"",onClick:l=>{return a=e,void B.confirm(`确认删除设备 ${a.name}？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"danger"}).then((()=>{Q.value=Q.value.filter((e=>e.id!==a.id)),U.setMonitoringData(Q.value,ee.value),p.success("设备已删除")})).catch((()=>{}));var a}},{default:d((()=>l[12]||(l[12]=[y("删除")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[Se,N.value]])])),_:1}),s(pe,{class:"alarm-card"},{header:d((()=>[u("div",P,[u("div",X,[l[13]||(l[13]=u("span",{class:"title"},"告警信息",-1)),s(I,{type:"danger"},{default:d((()=>[y(f(ee.value.filter((e=>"严重"===e.level)).length)+" 严重",1)])),_:1}),s(I,{type:"warning"},{default:d((()=>[y(f(ee.value.filter((e=>"警告"===e.level)).length)+" 警告",1)])),_:1})]),u("div",E,[s(xe,{type:"primary",link:"",onClick:fe},{default:d((()=>[s(Ve,null,{default:d((()=>[s(_(b))])),_:1}),l[14]||(l[14]=y("刷新 "))])),_:1}),s(xe,{type:"danger",link:"",onClick:ye},{default:d((()=>[s(Ve,null,{default:d((()=>[s(_(k))])),_:1}),l[15]||(l[15]=y("清空已处理 "))])),_:1})])])])),default:d((()=>[h((o(),r(Te,{data:ee.value,style:{width:"100%"},size:"large",border:""},{default:d((()=>[s(Me,{prop:"title",label:"告警标题","min-width":"180"}),s(Me,{prop:"content",label:"告警内容","min-width":"300","show-overflow-tooltip":""}),s(Me,{prop:"level",label:"级别",width:"100"},{default:d((({row:e})=>[s(I,{type:ge(e.level)},{default:d((()=>[y(f(e.level),1)])),_:2},1032,["type"])])),_:1}),s(Me,{prop:"location",label:"位置",width:"120"}),s(Me,{prop:"time",label:"时间",width:"180"}),s(Me,{prop:"type",label:"类型",width:"120"}),s(Me,{prop:"count",label:"次数",width:"80",align:"right"}),s(Me,{label:"操作",width:"180",fixed:"right"},{default:d((({row:e})=>[s(xe,{type:"primary",link:"",onClick:l=>{return a=e,void B.confirm(`确认处理告警 "${a.title}"？`,"处理确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{ee.value=ee.value.filter((e=>e.id!==a.id)),U.setMonitoringData(Q.value,ee.value),p.success("告警已处理")})).catch((()=>{}));var a}},{default:d((()=>l[16]||(l[16]=[y("处理")]))),_:2},1032,["onClick"]),s(xe,{type:"success",link:"",onClick:l=>{return a=e,ee.value=ee.value.filter((e=>e.id!==a.id)),U.setMonitoringData(Q.value,ee.value),void p.success("告警已忽略");var a}},{default:d((()=>l[17]||(l[17]=[y("忽略")]))),_:2},1032,["onClick"]),s(xe,{type:"info",link:"",onClick:l=>{return a=e,void B.alert(`\n    <p><strong>告警内容：</strong>${a.content}</p>\n    <p><strong>位置：</strong>${a.location}</p>\n    <p><strong>时间：</strong>${a.time}</p>\n    <p><strong>类型：</strong>${a.type}</p>\n    <p><strong>告警次数：</strong>${a.count}</p>\n    `,`告警详情 - ${a.title}`,{dangerouslyUseHTMLString:!0,confirmButtonText:"关闭"});var a}},{default:d((()=>l[18]||(l[18]=[y("详情")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[Se,N.value]])])),_:1}),s(De,{modelValue:le.value,"onUpdate:modelValue":l[1]||(l[1]=e=>le.value=e),title:null==(a=ae.value)?void 0:a.name,width:"800px",class:"camera-dialog"},{default:d((()=>{var e,a,t;return[u("div",L,[u("div",J,[s(Ve,{size:64},{default:d((()=>[s(_(C))])),_:1}),l[22]||(l[22]=u("span",null,"监控预览",-1)),u("div",W,[u("p",null,[l[19]||(l[19]=u("strong",null,"位置：",-1)),y(f(null==(e=ae.value)?void 0:e.location),1)]),u("p",null,[l[20]||(l[20]=u("strong",null,"类型：",-1)),y(f(null==(a=ae.value)?void 0:a.type),1)]),u("p",null,[l[21]||(l[21]=u("strong",null,"状态：",-1)),s(I,{type:ve(null==(t=ae.value)?void 0:t.status)},{default:d((()=>{var e;return[y(f(null==(e=ae.value)?void 0:e.status),1)]})),_:1},8,["type"])])])])]),u("div",Y,[u("div",Z,[l[23]||(l[23]=u("span",{class:"control-label"},"方向控制",-1)),s($e,null,{default:d((()=>[s(xe,{type:"primary",icon:_(V)},null,8,["icon"]),s(xe,{type:"primary",icon:_(x)},null,8,["icon"]),s(xe,{type:"primary",icon:_(M)},null,8,["icon"]),s(xe,{type:"primary",icon:_(T)},null,8,["icon"])])),_:1})]),u("div",G,[l[24]||(l[24]=u("span",{class:"control-label"},"变焦控制",-1)),s($e,null,{default:d((()=>[s(xe,{type:"primary",icon:_($)},null,8,["icon"]),s(xe,{type:"primary",icon:_(D)},null,8,["icon"])])),_:1})])])]})),_:1},8,["modelValue","title"]),s(De,{modelValue:te.value,"onUpdate:modelValue":l[6]||(l[6]=e=>te.value=e),title:"添加监控点",width:"500px","destroy-on-close":""},{footer:d((()=>[u("div",K,[s(xe,{onClick:l[5]||(l[5]=e=>te.value=!1)},{default:d((()=>l[25]||(l[25]=[y("取消")]))),_:1}),s(xe,{type:"primary",onClick:_e},{default:d((()=>l[26]||(l[26]=[y("确定")]))),_:1})])])),default:d((()=>[s(Ue,{ref_key:"addFormRef",ref:oe,model:ne.value,rules:ie,"label-width":"100px",class:"dialog-form"},{default:d((()=>[s(Ie,{label:"设备名称",prop:"name"},{default:d((()=>[s(Be,{modelValue:ne.value.name,"onUpdate:modelValue":l[2]||(l[2]=e=>ne.value.name=e),placeholder:"请输入设备名称，格式：IPC-X0-00"},null,8,["modelValue"])])),_:1}),s(Ie,{label:"安装位置",prop:"location"},{default:d((()=>[s(Be,{modelValue:ne.value.location,"onUpdate:modelValue":l[3]||(l[3]=e=>ne.value.location=e),placeholder:"请输入安装位置"},null,8,["modelValue"])])),_:1}),s(Ie,{label:"设备类型",prop:"type"},{default:d((()=>[s(Ce,{modelValue:ne.value.type,"onUpdate:modelValue":l[4]||(l[4]=e=>ne.value.type=e),placeholder:"请选择设备类型",class:"form-select"},{default:d((()=>[(o(),n(g,null,m(re,(e=>s(ke,{key:e,label:e,value:e},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-4d52e6df"]]);export{Q as default};
