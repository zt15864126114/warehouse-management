import{r as d,c as re,w as de,a1 as ie,o as ce,f as O,k as _,g as a,x as o,j as s,V as h,Y as pe,y as x,u as E,Z as ve,R as I,S as j,I as p,_ as me,$ as ge,e as S,J as fe,X as M,a0 as B}from"./element-plus-D9U92kps.js";import{s as g,a as _e}from"./index-Bk0e3mkj.js";import{_ as be}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ye={class:"outbound"},ke={class:"toolbar"},he={class:"search-area"},we={class:"pagination"},Ce={class:"dialog-footer"},Ve={name:"Outbound"},Ne=Object.assign(Ve,{setup(xe){const D=d(!1),u=d([]),U=d([]),b=d(1),y=d(10),$=d(0),P=["电子产品","服装","食品","家具","其他"],R=[{label:"待出库",value:"待出库"},{label:"已出库",value:"已出库"},{label:"已取消",value:"已取消"}],r=d({keyword:"",status:""}),f=d(!1),T=d(null),n=d({productName:"",category:"",quantity:1,operator:"管理员"}),A={productName:[{required:!0,message:"请输入商品名称",trigger:"blur"}],category:[{required:!0,message:"请选择商品分类",trigger:"change"}],quantity:[{required:!0,message:"请输入数量",trigger:"blur"}],operator:[{required:!0,message:"请输入操作人",trigger:"blur"}]},k=d("add"),F=re(()=>k.value==="add"?"新增出库":"编辑出库"),z=async()=>{D.value=!0;try{if(g.state.outbound.list.length>0)u.value=g.state.outbound.list,i();else{const{data:l}=await _e.get("/api/outbound/list");l.code===200&&(u.value=l.data,g.setOutboundData(l.data,l.data.length),i())}}catch(l){console.error("获取出库单列表失败:",l),h.error("获取出库单列表失败")}D.value=!1},J=l=>({待出库:"warning",已出库:"success",已取消:"info"})[l],K=()=>{b.value=1,i()};de([()=>r.value.keyword,()=>r.value.status],()=>{K()});const X=()=>{k.value="add",n.value={productName:"",category:"",quantity:1,operator:"管理员"},f.value=!0},i=()=>{if(!u.value.length)return;let l=u.value;(r.value.keyword||r.value.status)&&(l=u.value.filter(v=>{const C=!r.value.keyword||v.productName.toLowerCase().includes(r.value.keyword.toLowerCase())||v.orderNo.toLowerCase().includes(r.value.keyword.toLowerCase()),V=!r.value.status||v.status===r.value.status;return C&&V})),$.value=l.length;const e=(b.value-1)*y.value,w=e+y.value;U.value=l.slice(e,w)},Y=l=>{B.confirm(`确认出库订单"${l.orderNo}"？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{u.value=u.value.map(e=>e.id===l.id?{...e,status:"已出库"}:e),g.setOutboundData(u.value,u.value.length),i(),h.success("出库成功")}).catch(()=>{})},Z=l=>{B.confirm(`确定要取消出库订单"${l.orderNo}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{u.value=u.value.map(e=>e.id===l.id?{...e,status:"已取消"}:e),g.setOutboundData(u.value,u.value.length),i(),h.success("取消成功")}).catch(()=>{})},G=l=>{k.value="edit",n.value={id:l.id,productName:l.productName,category:l.category,quantity:l.quantity,operator:l.operator},f.value=!0},H=l=>{B.confirm(`确定要删除出库单"${l.orderNo}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{u.value=u.value.filter(e=>e.id!==l.id),g.setOutboundData(u.value,u.value.length),i(),h.success("删除成功")}).catch(()=>{})},Q=async()=>{T.value&&await T.value.validate(l=>{if(l){if(k.value==="add"){const e={id:Date.now(),...n.value,orderNo:`OUT${Date.now()}`,status:"待出库",createTime:new Date().toISOString()};u.value=[e,...u.value]}else u.value=u.value.map(e=>e.id===n.value.id?{...e,...n.value,orderNo:e.orderNo,status:e.status,createTime:e.createTime}:e);g.setOutboundData(u.value,u.value.length),i(),h.success(k.value==="add"?"添加成功":"更新成功"),f.value=!1}})},W=l=>{y.value=l,i()},ee=l=>{b.value=l,i()};return ie(()=>{z()}),ce(()=>{z()}),(l,e)=>{const w=s("el-icon"),v=s("el-input"),C=s("el-option"),V=s("el-select"),m=s("el-button"),L=s("el-card"),c=s("el-table-column"),te=s("el-tag"),ae=s("el-table"),le=s("el-pagination"),N=s("el-form-item"),oe=s("el-input-number"),ue=s("el-form"),ne=s("el-dialog"),se=pe("loading");return _(),O("div",ye,[a(L,{class:"toolbar-card"},{default:o(()=>[x("div",ke,[x("div",he,[a(v,{modelValue:r.value.keyword,"onUpdate:modelValue":e[0]||(e[0]=t=>r.value.keyword=t),placeholder:"搜索商品名称/订单号",class:"search-input",clearable:""},{prefix:o(()=>[a(w,null,{default:o(()=>[a(E(ve))]),_:1})]),_:1},8,["modelValue"]),a(V,{modelValue:r.value.status,"onUpdate:modelValue":e[1]||(e[1]=t=>r.value.status=t),placeholder:"订单状态",clearable:"",class:"status-select"},{default:o(()=>[(_(),O(I,null,j(R,t=>a(C,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),a(m,{type:"primary",onClick:X},{default:o(()=>[a(w,null,{default:o(()=>[a(E(me))]),_:1}),e[10]||(e[10]=p("新增出库 "))]),_:1})])]),_:1}),a(L,{class:"table-card"},{default:o(()=>[ge((_(),S(ae,{data:U.value,style:{width:"100%"},size:"large",border:""},{default:o(()=>[a(c,{prop:"orderNo",label:"订单编号",width:"150"}),a(c,{prop:"productName",label:"商品名称","min-width":"200","show-overflow-tooltip":""}),a(c,{prop:"category",label:"分类",width:"120"}),a(c,{prop:"quantity",label:"数量",width:"100",align:"right"}),a(c,{prop:"operator",label:"操作人",width:"120"}),a(c,{prop:"status",label:"状态",width:"100"},{default:o(({row:t})=>[a(te,{type:J(t.status)},{default:o(()=>[p(fe(t.status),1)]),_:2},1032,["type"])]),_:1}),a(c,{prop:"createTime",label:"创建时间",width:"180"}),a(c,{label:"操作",width:"220",fixed:"right"},{default:o(({row:t})=>[t.status==="待出库"?(_(),S(m,{key:0,type:"success",link:"",onClick:q=>Y(t)},{default:o(()=>e[11]||(e[11]=[p(" 确认出库 ")])),_:2},1032,["onClick"])):M("",!0),t.status==="待出库"?(_(),S(m,{key:1,type:"danger",link:"",onClick:q=>Z(t)},{default:o(()=>e[12]||(e[12]=[p(" 取消出库 ")])),_:2},1032,["onClick"])):M("",!0),a(m,{type:"primary",link:"",onClick:q=>G(t)},{default:o(()=>e[13]||(e[13]=[p(" 编辑 ")])),_:2},1032,["onClick"]),a(m,{type:"danger",link:"",onClick:q=>H(t)},{default:o(()=>e[14]||(e[14]=[p(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[se,D.value]]),x("div",we,[a(le,{"current-page":b.value,"onUpdate:currentPage":e[2]||(e[2]=t=>b.value=t),"page-size":y.value,"onUpdate:pageSize":e[3]||(e[3]=t=>y.value=t),"page-sizes":[10,20,50,100],total:$.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:W,onCurrentChange:ee},null,8,["current-page","page-size","total"])])]),_:1}),a(ne,{modelValue:f.value,"onUpdate:modelValue":e[9]||(e[9]=t=>f.value=t),title:F.value,width:"500px","destroy-on-close":""},{footer:o(()=>[x("div",Ce,[a(m,{onClick:e[8]||(e[8]=t=>f.value=!1)},{default:o(()=>e[15]||(e[15]=[p("取消")])),_:1}),a(m,{type:"primary",onClick:Q},{default:o(()=>e[16]||(e[16]=[p("确定")])),_:1})])]),default:o(()=>[a(ue,{ref_key:"formRef",ref:T,model:n.value,rules:A,"label-width":"100px",class:"dialog-form"},{default:o(()=>[a(N,{label:"商品名称",prop:"productName"},{default:o(()=>[a(v,{modelValue:n.value.productName,"onUpdate:modelValue":e[4]||(e[4]=t=>n.value.productName=t),placeholder:"请输入商品名称"},null,8,["modelValue"])]),_:1}),a(N,{label:"商品分类",prop:"category"},{default:o(()=>[a(V,{modelValue:n.value.category,"onUpdate:modelValue":e[5]||(e[5]=t=>n.value.category=t),placeholder:"请选择分类",class:"form-select"},{default:o(()=>[(_(),O(I,null,j(P,t=>a(C,{key:t,label:t,value:t},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(N,{label:"数量",prop:"quantity"},{default:o(()=>[a(oe,{modelValue:n.value.quantity,"onUpdate:modelValue":e[6]||(e[6]=t=>n.value.quantity=t),min:1,class:"form-number"},null,8,["modelValue"])]),_:1}),a(N,{label:"操作人",prop:"operator"},{default:o(()=>[a(v,{modelValue:n.value.operator,"onUpdate:modelValue":e[7]||(e[7]=t=>n.value.operator=t),placeholder:"请输入操作人"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Oe=be(Ne,[["__scopeId","data-v-5cab8525"]]);export{Oe as default};
